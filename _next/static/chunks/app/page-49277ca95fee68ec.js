(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2048:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>eg});var o=n(5155),r=n(2115),a=n(3166),i=n(8236),l=n(5074),s=n(2558),c=n(7481),d=n(4052),u=n.n(d),f=n(968),p=n(2085),m=n(9434);let h=(0,p.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),g=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(f.b,{ref:t,className:(0,m.cn)(h(),n),...r})});g.displayName=f.b.displayName;let x=r.forwardRef((e,t)=>{let{className:n,type:r,...a}=e;return(0,o.jsx)("input",{type:r,className:(0,m.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:t,...a})});x.displayName="Input";var v=n(9708);let b=(0,p.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),y=r.forwardRef((e,t)=>{let{className:n,variant:r,size:a,asChild:i=!1,...l}=e,s=i?v.DX:"button";return(0,o.jsx)(s,{className:(0,m.cn)(b({variant:r,size:a,className:n})),ref:t,...l})});y.displayName="Button";var w=n(6170),j=n(9502),N=n(2448),k=n(704);let S=k.bL,C=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(k.B8,{ref:t,className:(0,m.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",n),...r})});C.displayName=k.B8.displayName;let I=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(k.l9,{ref:t,className:(0,m.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",n),...r})});I.displayName=k.l9.displayName;let A=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(k.UC,{ref:t,className:(0,m.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",n),...r})});A.displayName=k.UC.displayName;var z=n(5673),E=n(3158),M=n(518),R=n(154);let P=z.bL,L=z.l9;z.YJ,z.ZL,z.Pb,z.z6,r.forwardRef((e,t)=>{let{className:n,inset:r,children:a,...i}=e;return(0,o.jsxs)(z.ZP,{ref:t,className:(0,m.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",n),...i,children:[a,(0,o.jsx)(E.A,{className:"ml-auto"})]})}).displayName=z.ZP.displayName,r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(z.G5,{ref:t,className:(0,m.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...r})}).displayName=z.G5.displayName;let O=r.forwardRef((e,t)=>{let{className:n,sideOffset:r=4,...a}=e;return(0,o.jsx)(z.ZL,{children:(0,o.jsx)(z.UC,{ref:t,sideOffset:r,className:(0,m.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...a})})});O.displayName=z.UC.displayName;let F=r.forwardRef((e,t)=>{let{className:n,inset:r,...a}=e;return(0,o.jsx)(z.q7,{ref:t,className:(0,m.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",n),...a})});F.displayName=z.q7.displayName,r.forwardRef((e,t)=>{let{className:n,children:r,checked:a,...i}=e;return(0,o.jsxs)(z.H_,{ref:t,className:(0,m.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),checked:a,...i,children:[(0,o.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,o.jsx)(z.VF,{children:(0,o.jsx)(M.A,{className:"h-4 w-4"})})}),r]})}).displayName=z.H_.displayName,r.forwardRef((e,t)=>{let{className:n,children:r,...a}=e;return(0,o.jsxs)(z.hN,{ref:t,className:(0,m.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...a,children:[(0,o.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,o.jsx)(z.VF,{children:(0,o.jsx)(R.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=z.hN.displayName,r.forwardRef((e,t)=>{let{className:n,inset:r,...a}=e;return(0,o.jsx)(z.JU,{ref:t,className:(0,m.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",n),...a})}).displayName=z.JU.displayName,r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(z.wv,{ref:t,className:(0,m.cn)("-mx-1 my-1 h-px bg-muted",n),...r})}).displayName=z.wv.displayName;let D=e=>{let{children:t,bringToFront:n,id:a,initialPosition:i,isMaximized:l,onMoveEnd:s}=e,[c,d]=(0,r.useState)(!1),[u,f]=(0,r.useState)(i||{x:50,y:50}),p=(0,r.useRef)(null),m=(0,r.useRef)(null);(0,r.useEffect)(()=>{i&&!l&&f(i),l&&f({x:0,y:0})},[i,l]);let h=(0,r.useCallback)(e=>{c&&!l&&f(t=>({x:t.x+e.movementX,y:t.y+e.movementY}))},[c,l]),g=(0,r.useCallback)(()=>{if(c){if(d(!1),p.current&&m.current&&s){let e={x:p.current.offsetLeft,y:p.current.offsetTop},t=m.current;(t.x!==e.x||t.y!==e.y)&&s(a,e)}m.current=null}},[c,s,a]);(0,r.useEffect)(()=>{if(c)return window.addEventListener("mousemove",h),window.addEventListener("mouseup",g),window.addEventListener("mouseleave",g),()=>{window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",g),window.removeEventListener("mouseleave",g)}},[c,h,g]);let x=l?{position:"fixed",inset:0,margin:0,transform:"none"}:{position:"absolute",left:u.x,top:u.y};return(0,o.jsx)("div",{ref:p,className:" ".concat(l?"":"absolute"),style:x,onMouseDown:e=>{!(l||e.target.closest(".cursor-nwse-resize, button, input, textarea, select"))&&(d(!0),p.current&&(m.current={x:p.current.offsetLeft,y:p.current.offsetTop}),n(a),e.preventDefault())},children:t})};var _=n(6438),T=n(7822),W=n(3884),U=n(5318);let H=e=>{let{id:t,instanceId:n,name:a,icon:i,component:s,componentProps:c,initialWidth:d,initialHeight:u,initialPosition:f,zIndex:p,onClose:m,bringToFront:h,minimizeApp:g,isMinimized:x,isMaximized:v,toggleMaximize:b,windowRefSetter:y,onWindowMoveOrResize:w,isFocused:j,openAppOrFile:N,fileSystem:k,currentPath:S,onFileSystemChange:C,onCurrentPathChange:I,onFileSave:A,onCommandLineInputChange:z,onCommandLineOutputChange:E}=e,[M,R]=(0,l.A)(["windowSize_".concat(n),"windowPosition_".concat(n)]),[P,L]=(0,r.useState)(!1),O=(0,r.useRef)(null);(0,r.useRef)(null);let F=(0,r.useRef)(null),H=(0,r.useCallback)(()=>{let e=M["windowSize_".concat(n)];return e&&"object"==typeof e&&e.width&&e.height?{width:e.width,height:e.height}:{width:d>0?d:400,height:u>0?u:300}},[n,d,u,M]),V=(0,r.useCallback)(()=>{var e,t;let o=M["windowPosition_".concat(n)];return o&&"object"==typeof o&&"number"==typeof o.x&&"number"==typeof o.y?{x:o.x,y:o.y}:f||{x:50+parseInt(null!==(e=n.split("-")[1])&&void 0!==e?e:"0",10)%5*20,y:50+parseInt(null!==(t=n.split("-")[1])&&void 0!==t?t:"0",10)%5*20}},[n,f,M]),[J,Y]=(0,r.useState)(H),[B,G]=(0,r.useState)(J.width),[Z,X]=(0,r.useState)(J.height),[$,q]=(0,r.useState)(V),[K,Q]=(0,r.useState)(!1),[ee,et]=(0,r.useState)(!1),en=(0,r.useCallback)(e=>{O.current=e,y(n,e)},[n,y]);(0,r.useEffect)(()=>{L(!0)},[]),(0,r.useEffect)(()=>{if(P){let e=H(),t=V();Y(e),q(t),G(e.width),X(e.height)}},[P,n,H,V]),(0,r.useEffect)(()=>{P&&(v?(G(window.innerWidth),X(window.innerHeight-48)):K||(G(J.width),X(J.height)))},[v,J,P,K]),(0,r.useEffect)(()=>{if(!v&&P&&!K){let e=setTimeout(()=>{let e={width:B,height:Z};(e.width!==J.width||e.height!==J.height)&&(R("windowSize_".concat(n),e,{path:"/",maxAge:2592e3}),w(n,void 0,e),Y(e))},500);return()=>clearTimeout(e)}},[B,Z,n,R,v,w,P,K,J.width,J.height]);let eo=(0,r.useCallback)(e=>{if(!K||v||!F.current)return;let t=e.clientX-F.current.x,n=e.clientY-F.current.y;G(e=>Math.max(200,e+t)),X(e=>Math.max(150,e+n)),F.current={x:e.clientX,y:e.clientY}},[K,v]),er=(0,r.useCallback)(()=>{K&&(Q(!1),F.current=null)},[K]);(0,r.useEffect)(()=>{if(K)return window.addEventListener("mousemove",eo),window.addEventListener("mouseup",er),window.addEventListener("mouseleave",er),()=>{window.removeEventListener("mousemove",eo),window.removeEventListener("mouseup",er),window.removeEventListener("mouseleave",er)}},[K,eo,er]);let ea=(0,r.useCallback)((e,t)=>{v||e!==n||(q(t),w(n,t),R("windowPosition_".concat(n),t,{path:"/",maxAge:2592e3}))},[n,w,v,R]),ei=(0,r.useMemo)(()=>{let e={openAppOrFile:N,fileSystem:k,currentPath:S,onFileSystemChange:C,onCurrentPathChange:I,onSave:A,..."commandline"===t&&{onInputChange:e=>null==z?void 0:z(n,e),onOutputChange:e=>null==E?void 0:E(n,e),id:n,isFocused:j}};return(0,o.jsx)(s,{...c,...e})},[s,c,N,k,S,C,I,A,t,n,z,E,j]);if(!P||x)return null;let el={width:v?"100%":B,height:v?"calc(100vh - ".concat(TASKBAR_HEIGHT,"px)"):Z,top:v?0:void 0,left:v?0:void 0,zIndex:p,transition:K?"none":"width 0.2s ease-out, height 0.2s ease-out, top 0.2s ease-out, left 0.2s ease-out, opacity 0.3s ease-out",opacity:+!ee,position:v?"fixed":"absolute",margin:v?0:void 0,backgroundColor:"hsl(var(--window-background))"};return(0,o.jsx)(D,{bringToFront:()=>h(n),id:n,initialPosition:$,isMaximized:v,onMoveEnd:ea,children:(0,o.jsxs)("div",{ref:en,className:"flex flex-col shadow-md rounded-md border transition-opacity duration-300 ".concat(ee?"opacity-0":""," ").concat(v?"!fixed !inset-0 !translate-x-0 !translate-y-0 !m-0 !rounded-none":""," ").concat(j?"border-highlight-color shadow-lg":"border-window-frame"),style:el,onClick:()=>h(n),children:[(0,o.jsxs)("div",{className:"flex items-center justify-between h-8 px-2 rounded-t-md cursor-move ".concat(j?"bg-highlight-color text-white":"bg-window-frame text-white"),children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("span",{className:"mr-2",children:i}),(0,o.jsx)("span",{children:a})]}),(0,o.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,o.jsx)("button",{onClick:e=>{e.stopPropagation(),g(n)},className:"hover:bg-gray-600 p-1 rounded",children:(0,o.jsx)(_.A,{size:16})}),(0,o.jsx)("button",{onClick:e=>{e.stopPropagation(),b(n)},className:"hover:bg-gray-600 p-1 rounded",children:v?(0,o.jsx)(T.A,{size:16}):(0,o.jsx)(W.A,{size:16})}),(0,o.jsx)("button",{onClick:()=>{et(!0),setTimeout(()=>{m(),et(!1)},300)},className:"hover:bg-gray-600 p-1 rounded",children:(0,o.jsx)(U.A,{size:16})})]})]}),(0,o.jsxs)("div",{className:"relative flex-grow overflow-auto flex flex-col bg-window-background rounded-b-md",children:[(0,o.jsxs)("div",{className:"flex-grow p-0",children:[" ",ei," "]}),!v&&(0,o.jsx)("div",{className:"absolute bottom-0 right-0 w-4 h-4 bg-window-frame rounded-br-md cursor-nwse-resize",onMouseDown:e=>{v||(e.preventDefault(),e.stopPropagation(),F.current={x:e.clientX,y:e.clientY},Q(!0))}})]})]})})},V=e=>{let t=e.getHours().toString().padStart(2,"0"),n=e.getMinutes().toString().padStart(2,"0");return"".concat(t,":").concat(n)},J=e=>{let{openApps:t,applications:n,onAppClick:a,onRestore:i,onMinimize:l}=e,[s,c]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=()=>{c(V(new Date))};e();let t=setInterval(e,6e4);return()=>clearInterval(t)},[]);let d=e=>n.find(t=>t.id===e);return(0,o.jsxs)("div",{className:"fixed bottom-0 left-0 right-0 h-12 bg-window-frame flex items-center px-4 space-x-2 z-50 border-t border-gray-600",children:[(0,o.jsx)("div",{className:"text-xs text-white px-2 mr-auto",children:s}),t.slice(-5).map(e=>{let n=d(e.id);return n?(0,o.jsxs)(y,{variant:"ghost",size:"sm",className:"h-8 px-2 py-1 flex items-center space-x-1 transition-colors ".concat(e.isMinimized?"opacity-70 bg-gray-700 hover:bg-gray-600":"bg-gray-600 hover:bg-gray-500"),onClick:()=>{e.isMinimized?i(e.instanceId):t.reduce((e,t)=>Math.max(e,t.zIndex),0)===e.zIndex?l(e.instanceId):a(e.instanceId)},children:[(0,o.jsx)("span",{className:"text-lg",children:n.icon}),(0,o.jsx)("span",{className:"text-xs text-white truncate max-w-[80px]",children:e.file?"".concat(n.name," - ").concat(e.file.name):n.name})]},e.instanceId):null})]})};var Y=n(6766);let B=e=>{console.log("Attempting to simulate Python script:\n",e);let t=e.split("\n"),n="[Simulated Python Output]:\n";try{for(let e of t){let t=e.trim();if(t.startsWith("print(")){let e=t.match(/^print\((.*)\)$/);if(e){let t=e[1].trim();if(t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'"))n+=t.slice(1,-1)+"\n";else try{n+=t+" (expression/variable)\n"}catch(e){n+="Error evaluating: ".concat(t,"\n")}}}else t.length>0&&t.startsWith("#")}}catch(e){return"Runtime Error: ".concat(e.message)}return n.trim()},G=e=>{let{id:t,icon:n,name:a,initialPosition:i,onClick:l,onMoveEnd:s,containerRef:c,gridSize:d=110,padding:u=16}=e,[f,p]=(0,r.useState)(!1),[m,h]=(0,r.useState)(i),g=(0,r.useRef)(null),x=(0,r.useRef)(null),v=(0,r.useRef)(null),b=(0,r.useRef)(!1);(0,r.useEffect)(()=>{h(i)},[i]);let y=(0,r.useCallback)(e=>{0===e.button&&(e.preventDefault(),e.stopPropagation(),x.current={x:e.clientX,y:e.clientY},g.current&&(v.current={x:g.current.offsetLeft,y:g.current.offsetTop}),b.current=!1,p(!0))},[]),w=(0,r.useCallback)(e=>{if(!f||!x.current||!v.current||!g.current||!c.current)return;let t=e.clientX-x.current.x,n=e.clientY-x.current.y;(Math.abs(t)>5||Math.abs(n)>5)&&(b.current=!0);let o=v.current.x+t,r=v.current.y+n,a=c.current.getBoundingClientRect(),i=a.width-100-u,l=a.height-100-u-48;h({x:o=Math.max(u,Math.min(o,i)),y:r=Math.max(u,Math.min(r,l))})},[f,c,u]),j=(0,r.useCallback)(()=>{f&&(p(!1),g.current&&v.current&&b.current&&s(t,{x:g.current.offsetLeft,y:g.current.offsetTop}),x.current=null,v.current=null,b.current||l())},[f,t,s,l]);return(0,r.useEffect)(()=>{if(f)return window.addEventListener("mousemove",w),window.addEventListener("mouseup",j),window.addEventListener("mouseleave",j),()=>{window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",j),window.removeEventListener("mouseleave",j)}},[f,w,j]),(0,o.jsxs)("div",{ref:g,className:"absolute flex flex-col items-center justify-center p-2 rounded-md cursor-pointer hover:bg-gray-700/50 transition-colors w-[100px] h-[100px]",style:{left:"".concat(m.x,"px"),top:"".concat(m.y,"px"),userSelect:f?"none":"auto",transition:f?"none":"left 0.1s ease-out, top 0.1s ease-out"},onMouseDown:y,children:[(0,o.jsx)("span",{className:"text-3xl text-icon-color",children:n}),(0,o.jsx)("span",{className:"text-xs text-icon-color text-center mt-1 truncate w-full",children:a})]})};var Z=n(3004),X=n(5317),$=n(3915);let q=(0,$.Dk)().length?(0,$.Sx)():(0,$.Wp)({apiKey:"AIzaSyCk8-GzoRyKMEp32X-zf8FNx1hNoOc56CE",authDomain:"lets-go-to-school-server.firebaseapp.com",projectId:"lets-go-to-school-server",storageBucket:"lets-go-to-school-server.appspot.com",messagingSenderId:"149825716219",appId:"1:149825716219:web:ef2c1e3b169efc5629155e",measurementId:"G-8WN948RYY3"}),K=(0,X.aU)(q),Q=(0,Z.xI)(q);var ee=n(5452);let et=ee.bL;ee.l9;let en=ee.ZL;ee.bm;let eo=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(ee.hJ,{ref:t,className:(0,m.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...r})});eo.displayName=ee.hJ.displayName;let er=r.forwardRef((e,t)=>{let{className:n,children:r,...a}=e;return(0,o.jsxs)(en,{children:[(0,o.jsx)(eo,{}),(0,o.jsxs)(ee.UC,{ref:t,className:(0,m.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...a,children:[r,(0,o.jsxs)(ee.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,o.jsx)(U.A,{className:"h-4 w-4"}),(0,o.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});er.displayName=ee.UC.displayName;let ea=e=>{let{className:t,...n}=e;return(0,o.jsx)("div",{className:(0,m.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...n})};ea.displayName="DialogHeader";let ei=e=>{let{className:t,...n}=e;return(0,o.jsx)("div",{className:(0,m.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...n})};ei.displayName="DialogFooter";let el=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(ee.hE,{ref:t,className:(0,m.cn)("text-lg font-semibold leading-none tracking-tight",n),...r})});el.displayName=ee.hE.displayName,r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(ee.VY,{ref:t,className:(0,m.cn)("text-sm text-muted-foreground",n),...r})}).displayName=ee.VY.displayName;let es={id:"commandline",icon:">"},ec={type:"folder",name:"root",children:[{type:"folder",name:"Desktop",children:[...[{id:"texteditor",name:"Text Editor",icon:"\uD83D\uDCC4"},{id:"calculator",name:"Calculator",icon:"\uD83E\uDDEE"},{id:"clock",name:"Clock",icon:"⏱️"},{id:"filebrowser",name:"File Browser",icon:"\uD83D\uDDC2️"},{id:"imageviewer",name:"Image Viewer",icon:"\uD83D\uDDBC️"},{id:"scripteditor",name:"Python Editor",icon:"\uD83D\uDC0D"}].map(e=>({type:"app-shortcut",name:"".concat(e.name),appId:e.id,icon:e.icon,path:"root/Desktop/".concat(e.name)})),{type:"app-shortcut",name:"Command Line",appId:es.id,icon:es.icon,path:"root/Desktop/Command Line"}],path:"root/Desktop"},{type:"folder",name:"Documents",children:[],path:"root/Documents"},{type:"folder",name:"Downloads",children:[],path:"root/Downloads"},{type:"file",name:"example.txt",content:"This is an example text file.",path:"root/example.txt"},{type:"file",name:"welcome.py",content:'print("Welcome to Python!")\nx = 10\nprint(f"x * 2 = {x * 2}")',path:"root/welcome.py"},{type:"file",name:"image.jpg",url:"https://picsum.photos/400/300",path:"root/image.jpg"}],path:"root"},ed=e=>{if(void 0===e)return null;if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return X.Dc.fromDate(e);if(e instanceof X.Dc)return e;if("object"==typeof e&&"type"in e&&"file"===e.type){let t={...e};for(let e in void 0===t.content&&(t.content=null),t)if(Object.prototype.hasOwnProperty.call(t,e)&&"content"!==e){let n=ed(t[e]);void 0!==n?t[e]=n:delete t[e]}return t}if(Array.isArray(e))return e.map(ed).filter(e=>void 0!==e);let t={};for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let o=ed(e[n]);void 0!==o&&(t[n]=o),"children"===n&&"folder"===e.type&&(t[n]=Array.isArray(o)?o:[])}return"folder"===e.type&&void 0===t.children&&(t.children=[]),t},eu=e=>{let t=e.split("@")[1];if(!t)return null;let n=t.match(/^(.+?)\.webos$/);return n?n[1]:null},ef=e=>{let{isOpen:t}=e,[n,a]=(0,r.useState)(""),[i,l]=(0,r.useState)(""),[s,d]=(0,r.useState)(!0),[u,f]=(0,r.useState)(null),{toast:p}=(0,c.dj)(),m=(0,Z.xI)(),h=async e=>{e.preventDefault(),f(null);try{if(s)await (0,Z.x9)(m,n,i),p({title:"Login Successful"});else{let e=eu(n);if(!e){f("Invalid email domain. Please use your school email (e.g., yourname@schoolname.webos)."),p({title:"Signup Failed",description:"Invalid email domain.",variant:"destructive"});return}let t=n.endsWith("@teacher.webos")?"teacher":"student",o=(await (0,Z.eJ)(m,n,i)).user;if(o){let n=(0,X.H9)(K,"users",o.uid);await (0,X.BN)(n,{email:o.email,createdAt:(0,X.O5)(),role:t,schoolId:e}),console.log("User document created in Firestore for:",o.uid,"with schoolId:",e);let r=(0,X.H9)(K,"userStates",o.uid),a=JSON.parse(JSON.stringify(ec)),i=ed({openApps:[],nextZIndex:1,fileSystem:a,currentPath:["root"],iconPositions:{},focusedWindowInstanceId:null,schoolId:e});await (0,X.BN)(r,i),console.log("Initial user state created in Firestore for:",o.uid,"with schoolId:",e)}p({title:"Signup Successful"})}}catch(t){console.error("Authentication error:",t);let e="An error occurred.";switch(t.code){case"auth/email-already-in-use":e="This email address is already in use.";break;case"auth/invalid-email":e="Please enter a valid email address.";break;case"auth/weak-password":e="Password should be at least 6 characters.";break;case"auth/user-not-found":case"auth/wrong-password":case"auth/invalid-credential":e="Invalid login credentials."}f(e),p({title:"Authentication Failed",description:e,variant:"destructive"})}};return(0,o.jsx)(et,{open:t,onOpenChange:()=>{},children:(0,o.jsxs)(er,{className:"sm:max-w-[425px]",children:[(0,o.jsx)(ea,{children:(0,o.jsx)(el,{children:s?"Login":"Sign Up"})}),(0,o.jsxs)("form",{onSubmit:h,children:[(0,o.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,o.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,o.jsx)(g,{htmlFor:"email",className:"text-right",children:"Email"}),(0,o.jsx)(x,{id:"email",type:"email",value:n,onChange:e=>a(e.target.value),className:"col-span-3",required:!0,placeholder:"yourname@schoolname.webos"})]}),(0,o.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,o.jsx)(g,{htmlFor:"password",className:"text-right",children:"Password"}),(0,o.jsx)(x,{id:"password",type:"password",value:i,onChange:e=>l(e.target.value),className:"col-span-3",required:!0,minLength:6})]}),u&&(0,o.jsx)("p",{className:"text-destructive text-sm col-span-4 text-center",children:u})]}),(0,o.jsxs)(ei,{className:"flex flex-col sm:flex-row sm:justify-between items-center",children:[(0,o.jsx)(y,{type:"button",variant:"link",onClick:()=>d(!s),children:s?"Need an account? Sign Up":"Already have an account? Login"}),(0,o.jsx)(y,{type:"submit",children:s?"Login":"Sign Up"})]})]})]})})},ep=[{id:"texteditor",name:"Text Editor",icon:"\uD83D\uDCC4",component:e=>{let{initialText:t="",fileName:n="Untitled",onSave:a}=e,[i,l]=(0,r.useState)(t),[s,d]=(0,r.useState)("black"),[u,f]=(0,r.useState)(n),{toast:p}=(0,c.dj)();(0,r.useEffect)(()=>{l(t),f(n)},[t,n]);let m=(0,r.useCallback)(()=>{a?(a(i,u),p({title:"Saved!",description:"".concat(u," saved successfully.")})):p({title:"Error!",description:"Cannot save file, no save handler provided.",variant:"destructive"})},[a,i,u,p]);return(0,o.jsxs)("div",{className:"flex flex-col h-full",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between p-2 border-b border-gray-600",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)(g,{htmlFor:"text-color",className:"mr-2",children:"Text Color:"}),(0,o.jsx)(x,{type:"color",id:"text-color",value:s,onChange:e=>{d(e.target.value)},className:"h-8 w-10"})]}),(0,o.jsx)(x,{type:"text",value:u,onChange:e=>f(e.target.value),className:"flex-grow mx-2 rounded-md"}),(0,o.jsx)(y,{onClick:m,children:"Save"})]}),(0,o.jsx)("textarea",{className:"w-full h-full p-2 bg-text-editor-background focus:outline-none resize-none rounded-md",style:{color:s},value:i,onChange:e=>{l(e.target.value)},placeholder:"Start typing..."})]})},initialWidth:400,initialHeight:300},{id:"calculator",name:"Calculator",icon:"\uD83E\uDDEE",component:()=>{let[e,t]=(0,r.useState)("0"),[n,a]=(0,r.useState)(""),[i,l]=(0,r.useState)(""),s=n=>{t("0"===e?n:e+n)},c=n=>{a(n),l(e),t("0")};return(0,o.jsxs)("div",{className:"flex flex-col bg-black rounded-md shadow-md p-2",children:[(0,o.jsx)("div",{className:"bg-secondary-foreground text-right p-2 rounded-md mb-2",children:e}),(0,o.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,o.jsx)("button",{className:"bg-calculator-button hover:bg-calculator-button-hover rounded-md p-2",onClick:()=>{t("0"),a(""),l("")},children:"C"}),(0,o.jsx)("button",{className:"bg-calculator-button hover:bg-calculator-button-hover rounded-md p-2",onClick:()=>c("/"),children:"/"}),(0,o.jsx)("button",{className:"bg-calculator-button hover:bg-calculator-button-hover rounded-md p-2",onClick:()=>c("*"),children:"*"}),(0,o.jsx)("button",{className:"bg-calculator-button hover:bg-calculator-button-hover rounded-md p-2",onClick:()=>c("-"),children:"-"}),(0,o.jsx)("button",{className:"bg-calculator-button hover:bg-calculator-button-hover rounded-md p-2",onClick:()=>s("7"),children:"7"}),(0,o.jsx)("button",{className:"bg-calculator-button hover:bg-calculator-button-hover rounded-md p-2",onClick:()=>s("8"),children:"8"}),(0,o.jsx)("button",{className:"bg-calculator-button hover:bg-calculator-button-hover rounded-md p-2",onClick:()=>s("9"),children:"9"}),(0,o.jsx)("button",{className:"bg-calculator-button hover:bg-calculator-button-hover rounded-md p-2 row-span-2",onClick:()=>c("+"),children:"+"}),(0,o.jsx)("button",{className:"bg-calculator-button hover:bg-calculator-button-hover rounded-md p-2",onClick:()=>s("4"),children:"4"}),(0,o.jsx)("button",{className:"bg-calculator-button hover:bg-calculator-button-hover rounded-md p-2",onClick:()=>s("5"),children:"5"}),(0,o.jsx)("button",{className:"bg-calculator-button hover:bg-calculator-button-hover rounded-md p-2",onClick:()=>s("6"),children:"6"}),(0,o.jsx)("button",{className:"bg-calculator-button hover:bg-calculator-button-hover rounded-md p-2",onClick:()=>s("1"),children:"1"}),(0,o.jsx)("button",{className:"bg-calculator-button hover:bg-calculator-button-hover rounded-md p-2",onClick:()=>s("2"),children:"2"}),(0,o.jsx)("button",{className:"bg-calculator-button hover:bg-calculator-button-hover rounded-md p-2",onClick:()=>s("3"),children:"3"}),(0,o.jsx)("button",{className:"bg-calculator-button hover:bg-calculator-button-hover rounded-md p-2 col-span-2",onClick:()=>s("0"),children:"0"}),(0,o.jsx)("button",{className:"bg-calculator-button hover:bg-calculator-button-hover rounded-md p-2",onClick:()=>s("."),children:"."}),(0,o.jsx)("button",{className:"bg-calculator-button hover:bg-calculator-button-hover rounded-md p-2",onClick:()=>{let o=parseFloat(i),r=parseFloat(e),s=0;switch(n){case"+":s=o+r;break;case"-":s=o-r;break;case"*":s=o*r;break;case"/":s=o/r;break;default:return}t(s.toString()),a(""),l("")},children:"="})]})]})},initialWidth:300,initialHeight:400},{id:"clock",name:"Clock",icon:"⏱️",component:()=>{let[e,t]=(0,r.useState)(new Date);(0,r.useEffect)(()=>{let e=setInterval(()=>{t(new Date)},1e3);return()=>clearInterval(e)},[]);let n=e.getHours(),a=e.getMinutes(),i=e.getSeconds();return(0,o.jsx)("div",{className:"flex items-center justify-center h-full w-full bg-black rounded-b-md",children:(0,o.jsxs)("div",{className:"relative w-48 h-48 rounded-full bg-clock-face border-4 border-gray-700 shadow-lg",children:[(()=>{let e=[];for(let t=1;t<=12;t++){let n=30*t,r=t%3==0;e.push((0,o.jsx)("div",{className:"absolute w-full h-full flex items-center justify-center",style:{transform:"rotate(".concat(n,"deg)")},children:(0,o.jsx)("div",{className:"absolute ".concat(r?"bg-foreground h-3 w-1":"bg-muted-foreground h-2 w-0.5"),style:{transform:"translateY(-80px)"}})},"hour-".concat(t)))}for(let t=0;t<60;t++)if(t%5!=0){let n=6*t;e.push((0,o.jsx)("div",{className:"absolute w-full h-full flex items-center justify-center",style:{transform:"rotate(".concat(n,"deg)")},children:(0,o.jsx)("div",{className:"absolute bg-muted-foreground h-1 w-[1px]",style:{transform:"translateY(-84px)"}})},"minute-".concat(t)))}return e})(),(0,o.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-3 h-3 bg-clock-hands rounded-full z-20 border-2 border-clock-face"}),(0,o.jsx)("div",{className:"absolute top-1/2 left-1/2 transform origin-center-left bg-clock-hands h-[5px] w-[35%] rounded-r-full z-10",style:{transform:"translateY(-50%) rotate(".concat((n%12+a/60)*30-90,"deg)"),transformOrigin:"left center",left:"50%"}}),(0,o.jsx)("div",{className:"absolute top-1/2 left-1/2 transform origin-center-left bg-clock-hands h-[3px] w-[45%] rounded-r-full z-10",style:{transform:"translateY(-50%) rotate(".concat((a+i/60)*6-90,"deg)"),transformOrigin:"left center",left:"50%"}}),(0,o.jsx)("div",{className:"absolute top-1/2 left-1/2 transform origin-center-left bg-red-500 h-[1px] w-[48%] z-10",style:{transform:"translateY(-50%) rotate(".concat(6*i-90,"deg)"),transformOrigin:"left center",left:"50%"}})]})})},initialWidth:200,initialHeight:200},{id:"filebrowser",name:"File Browser",icon:"\uD83D\uDDC2️",component:e=>{var t;let{openAppOrFile:n,onFileSystemChange:a,fileSystem:i,currentPath:l,onCurrentPathChange:s}=e,c=(0,r.useRef)(i),d=(0,r.useRef)(l),[u,f]=(0,r.useState)(null);(0,r.useEffect)(()=>{c.current=i},[i]),(0,r.useEffect)(()=>{d.current=l},[l]);let p=(0,r.useCallback)(()=>{let e=c.current;if(!e||"object"!=typeof e||"folder"!==e.type)return console.error("Invalid fileSystemRef in FileBrowser"),null;for(let t of d.current.slice(1)){let n=Array.isArray(e.children)?e.children.find(e=>e.name===t):void 0;if(!n||"folder"!==n.type)return console.warn("Path part not found or not a folder:",t,"in",d.current.join("/")),d.current.length>1&&(console.log("Resetting path to root due to invalid segment."),s(["root"])),null;e=n}return e&&"folder"===e.type&&!Array.isArray(e.children)&&(e.children=[]),e},[s]),h=(e,t)=>{t?n(e,!0):f(e.name)},g=e=>{if(!a){console.warn("onFileSystemChange prop is not provided to FileBrowser. Cannot delete.");return}let t=JSON.parse(JSON.stringify(c.current)),n=t,o=d.current.slice(1);for(let e=0;e<o.length;e++){var r;let t=o[e],a=null==n?void 0:null===(r=n.children)||void 0===r?void 0:r.find(e=>e.name===t&&"folder"===e.type);if(a&&"folder"===a.type)n=a;else{console.error("Path not found while deleting file.");return}}n&&Array.isArray(n.children)?(n.children=n.children.filter(t=>t.name!==e.name),a(t),f(null)):console.error("Could not find the directory to delete from.")},x=p(),v=(null==x?void 0:x.children)?[...x.children].sort((e,t)=>"folder"===e.type&&"folder"!==t.type?-1:"folder"!==e.type&&"folder"===t.type?1:"app-shortcut"===e.type&&"file"===t.type?-1:"file"===e.type&&"app-shortcut"===t.type?1:e.name.localeCompare(t.name)):[];return(0,o.jsx)("div",{className:"flex flex-col h-full bg-file-browser-background text-file-browser-foreground rounded-md shadow-md p-2",children:(0,o.jsxs)(S,{defaultValue:"files",className:"flex flex-col h-full",children:[(0,o.jsx)(C,{className:"flex items-center p-2 border-b border-gray-600",children:(0,o.jsx)(I,{value:"files",children:"Files"})}),(0,o.jsxs)(A,{value:"files",className:"p-2 flex-grow overflow-auto",children:[(0,o.jsxs)("div",{className:"flex items-center p-2 border-b border-gray-600",children:[(0,o.jsx)("button",{className:"bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded-md mr-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>{d.current.length>1&&(s(d.current.slice(0,-1)),f(null))},disabled:d.current.length<=1,children:"Back"}),(0,o.jsx)("span",{className:"text-sm text-file-browser-foreground",children:d.current.join("/")})]}),(0,o.jsx)("div",{className:"p-2 flex-grow overflow-auto",children:(null==x?void 0:x.type)==="folder"?(0,o.jsx)("ul",{children:v.map(e=>(0,o.jsxs)("li",{className:(0,m.cn)("flex items-center p-2 rounded-md hover:bg-gray-700 cursor-pointer",u===e.name&&"bg-blue-800/50"),onClick:()=>h(e,!1),onDoubleClick:()=>h(e,!0),onContextMenu:e=>{e.preventDefault()},children:["folder"===e.type?(0,o.jsx)(w.A,{className:"mr-2 text-yellow-400",size:16}):"app-shortcut"===e.type?e.icon?(0,o.jsx)("span",{className:"mr-2 text-lg",children:e.icon}):(0,o.jsx)(j.A,{className:"mr-2 text-white",size:16}):(0,o.jsx)(N.A,{className:"mr-2 text-white",size:16}),(0,o.jsx)("span",{className:"flex-grow truncate",children:e.name}),("file"===e.type||"folder"===e.type)&&a&&(0,o.jsxs)(P,{children:[(0,o.jsx)(L,{asChild:!0,children:(0,o.jsx)("button",{onClick:e=>e.stopPropagation(),className:"ml-auto flex-shrink-0 px-1 py-0.5 rounded-md hover:bg-gray-600 text-xs",children:"..."})}),(0,o.jsx)(O,{className:"w-32",children:(0,o.jsx)(F,{onClick:t=>{t.stopPropagation(),g(e)},children:"Delete"})})]})]},"".concat(d.current.join("/"),"-").concat(e.name)))}):(0,o.jsx)("p",{className:"text-sm text-file-browser-foreground",children:null===x?"Invalid directory: ".concat(d.current.join("/")):(null==x?void 0:null===(t=x.children)||void 0===t?void 0:t.length)===0?"This folder is empty.":"Loading..."})})]})]})})},initialWidth:500,initialHeight:400},{id:"imageviewer",name:"Image Viewer",icon:"\uD83D\uDDBC️",component:e=>{let{imageUrl:t}=e;return t?(0,o.jsx)("div",{className:"flex items-center justify-center h-full w-full bg-black rounded-b-md overflow-hidden",children:(0,o.jsx)(Y.default,{src:t,alt:"Image",width:400,height:300,style:{objectFit:"contain"},className:"max-w-full max-h-full"})}):(0,o.jsx)("div",{className:"flex items-center justify-center h-full w-full bg-window-background rounded-b-md text-muted-foreground",children:"No image selected."})},initialWidth:500,initialHeight:400},{id:"scripteditor",name:"Python Editor",icon:"\uD83D\uDC0D",component:e=>{let{initialScript:t="",fileName:n="Untitled.py",onSave:a}=e,[i,l]=(0,r.useState)(t),[s,d]=(0,r.useState)(n),[u,f]=(0,r.useState)(""),{toast:p}=(0,c.dj)();(0,r.useEffect)(()=>{l(t),d(/\.[^/.]+$/.test(n)?n:n.endsWith(".py")?n:"".concat(n,".py")),f("")},[t,n]);let m=(0,r.useCallback)(()=>{if(!a){p({title:"Error!",description:"Cannot save file, no save handler provided.",variant:"destructive"});return}let e=s.endsWith(".py")?s:"".concat(s,".py");e!==s&&d(e),a(i,e),p({title:"Saved!",description:"".concat(e," saved successfully.")})},[a,i,s,p]);return(0,o.jsxs)("div",{className:"flex flex-col h-full",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between p-2 border-b border-gray-600 bg-window-frame",children:[(0,o.jsx)(x,{type:"text",value:s,onChange:e=>d(e.target.value),className:"flex-grow mx-2 rounded-md bg-input text-foreground"}),(0,o.jsxs)("div",{className:"space-x-2",children:[(0,o.jsx)(y,{onClick:()=>{f("Running script...\n");let e=B(i);f(t=>"".concat(t).concat(e))},size:"sm",children:"Run"}),(0,o.jsx)(y,{onClick:m,size:"sm",children:"Save"})]})]}),(0,o.jsxs)("div",{className:"flex flex-grow overflow-hidden",children:[(0,o.jsx)("textarea",{className:"w-1/2 h-full p-2 bg-text-editor-background text-text-editor-foreground focus:outline-none resize-none rounded-bl-md font-mono border-r border-gray-600",value:i,onChange:e=>{l(e.target.value)},placeholder:"Enter Python Script...",spellCheck:"false"}),(0,o.jsx)("div",{className:"w-1/2 h-full p-2 bg-black text-green-300 overflow-auto whitespace-pre-line font-mono rounded-br-md",children:(0,o.jsx)("pre",{children:u})})]})]})},initialWidth:600,initialHeight:450},{id:"commandline",name:"Command Line",icon:">",component:e=>{let{openApp:t,fileSystem:n,currentPath:a,onFileSystemChange:i,onCurrentPathChange:l,id:s,initialInputValue:c,onInputChange:d,initialOutput:u,onOutputChange:f,isFocused:p}=e,[m,h]=(0,r.useState)(c),[g,v]=(0,r.useState)(u),b=(0,r.useRef)(null),y=(0,r.useRef)(null),w=(0,r.useRef)(n),j=(0,r.useRef)(a);(0,r.useEffect)(()=>{c!==m&&h(c)},[c]),(0,r.useEffect)(()=>{u!==g&&v(u)},[u]),(0,r.useEffect)(()=>{w.current=n},[n]),(0,r.useEffect)(()=>{j.current=a},[a]),(0,r.useEffect)(()=>{if(p&&b.current&&document.activeElement!==b.current&&(b.current.focus(),b.current.value)){let e=b.current.value.length;b.current.setSelectionRange(e,e)}},[p]),(0,r.useEffect)(()=>{y.current&&(y.current.scrollTop=y.current.scrollHeight)},[g]);let N=(0,r.useCallback)(()=>{let e=w.current;if(!e||"object"!=typeof e||"folder"!==e.type)return console.error("Invalid fileSystem state in CommandLine"),null;for(let t of j.current.slice(1)){let n=Array.isArray(e.children)?e.children.find(e=>e.name===t&&"folder"===e.type):void 0;if(!n||"folder"!==n.type)return j.current.length>1&&(console.warn('Path part "'.concat(t,'" not found in "').concat(j.current.join("/"),'". Resetting to root.')),l(["root"])),null;e=n}return e&&"folder"===e.type&&!Array.isArray(e.children)&&(e.children=[]),e},[l]),k=e=>e&&0!==e.length&&(1!==e.length||"root"!==e[0])?"~/"+e.slice(1).join("/"):"~",S=()=>{var e,n,o,r,a,c,u;let p=m.trim().split(" "),x=p[0].toLowerCase(),y=[],S=N(),C=k(j.current),I="user@webos:".concat(C,"$ ").concat(m);switch(x){case"help":y=["Available commands:","  help              Show this help message","  clear             Clear the terminal screen","  ls                List directory contents","  cd <folder>       Change directory","  cd ..             Go up one directory","  cd                Go to root directory (~)","  touch <filename>  Create an empty file","  mkdir <foldername> Create a new folder","  vi/vim <filename> Open a file in the editor (creates if not exists)"];break;case"clear":v(""),f(s,""),h(""),d(s,""),b.current&&b.current.focus();return;case"ls":y=S&&Array.isArray(S.children)?0===S.children.length?["(empty directory)"]:[...S.children].sort((e,t)=>"folder"===e.type&&"folder"!==t.type?-1:"folder"!==e.type&&"folder"===t.type?1:e.name.localeCompare(t.name)).map(e=>"".concat("folder"===e.type?e.name+"/":e.name)):["ls: cannot access '".concat(C,"': No such file or directory")];break;case"cd":let A=p[1];if(A&&"~"!==A&&"~/"!==A){if(".."===A)j.current.length>1&&l(j.current.slice(0,-1)),y=[];else{let t=null==S?void 0:null===(e=S.children)||void 0===e?void 0:e.find(e=>e.name===A&&"folder"===e.type);t?(l([...j.current,t.name]),y=[]):y=(null==S?void 0:null===(n=S.children)||void 0===n?void 0:n.find(e=>e.name===A&&"file"===e.type))?["cd: not a directory: ".concat(A)]:["cd: no such file or directory: ".concat(A)]}}else j.current.length>1&&l(["root"]),y=[];break;case"touch":let z=p[1];if(!z){y=["usage: touch file ..."];break}if(z.includes("/")){y=["touch: cannot create file '".concat(z,"': Invalid argument")];break}let E=N();if(E){if(Array.isArray(E.children)||(E.children=[]),E.children.find(e=>e.name===z)){y=[];break}let e=JSON.parse(JSON.stringify(w.current)),t=e,n=!0;for(let e of j.current.slice(1)){let r=null==t?void 0:null===(o=t.children)||void 0===o?void 0:o.find(t=>t.name===e&&"folder"===t.type);if(r&&"folder"===r.type)t=r;else{y=["touch: "+j.current.slice(1).join("/")+"/"+z+": No such file or directory"],t=null,n=!1;break}}n&&t&&"folder"===t.type?(Array.isArray(t.children)||(t.children=[]),t.children.push({type:"file",name:z,content:"",path:[...j.current,z].join("/")}),i(e),y=[]):y.length||(y=["touch: Cannot create file. Invalid path."])}else y=["touch: Cannot create file in non-existent directory: ".concat(C)];break;case"mkdir":let M=p[1];if(!M){y=["usage: mkdir directory ..."];break}if(M.includes("/")){y=["mkdir: cannot create directory '".concat(M,"': Invalid argument")];break}let R=N();if(R){if(Array.isArray(R.children)||(R.children=[]),R.children.find(e=>e.name===M)){y=["mkdir: cannot create directory '".concat(M,"': File exists")];break}let e=JSON.parse(JSON.stringify(w.current)),t=e,n=!0;for(let e of j.current.slice(1)){let o=null==t?void 0:null===(r=t.children)||void 0===r?void 0:r.find(t=>t.name===e&&"folder"===t.type);if(o&&"folder"===o.type)t=o;else{y=["mkdir: "+j.current.slice(1).join("/")+"/"+M+": No such file or directory"],t=null,n=!1;break}}if(n&&t&&"folder"===t.type){Array.isArray(t.children)||(t.children=[]);let n=[...j.current,M].join("/");t.children.push({type:"folder",name:M,children:[],path:n}),i(e),y=[]}else y.length||(y=["mkdir: Cannot create directory. Invalid path."])}else y=["mkdir: Cannot create directory in non-existent path: ".concat(C)];break;case"vi":case"vim":let P=p[1];if(!P){y=["usage: ".concat(x," file")];break}let L=N(),O=null==L?void 0:null===(a=L.children)||void 0===a?void 0:a.find(e=>e.name===P&&"file"===e.type);if(null==L?void 0:null===(c=L.children)||void 0===c?void 0:c.find(e=>e.name===P&&"folder"===e.type)){y=["".concat(x,": ").concat(P,": Is a directory")];break}if(O)t("texteditor",O),y=[];else if(N()){let e=JSON.parse(JSON.stringify(w.current)),n=e,o=!0;for(let e of j.current.slice(1)){let t=null==n?void 0:null===(u=n.children)||void 0===u?void 0:u.find(t=>t.name===e&&"folder"===t.type);if(t&&"folder"===t.type)n=t;else{y=["".concat(x,": Cannot open/create file. Invalid path segment: ").concat(e)],n=null,o=!1;break}}if(o&&n&&"folder"===n.type){Array.isArray(n.children)||(n.children=[]);let o=[...j.current,P].join("/"),r={type:"file",name:P,content:"",path:o};n.children.push(r),i(e),t("texteditor",r),y=[]}else y.length||(y=["".concat(x,": Cannot create file. Invalid path.")])}else y=["".concat(x,": Cannot open/create file in non-existent directory: ").concat(C)];break;default:y=x?["bash: command not found: ".concat(x)]:[]}let F=y.length>0?y.join("\n"):"",D="".concat(g?g+"\n":"").concat(I).concat(F?"\n"+F:"");v(D),f(s,D),h(""),d(s,"")};return(0,o.jsxs)("div",{className:"flex flex-col h-full bg-black text-gray-200 p-2 rounded-md font-mono text-sm",onClick:()=>{var e;return null===(e=b.current)||void 0===e?void 0:e.focus()},children:[(0,o.jsx)("div",{className:"flex-grow overflow-y-auto whitespace-pre-wrap p-1 mb-2",ref:y,children:g.split("\n").map((e,t)=>(0,o.jsx)("div",{children:e},"".concat(s,"-line-").concat(t)))}),(0,o.jsxs)("div",{className:"flex items-center mt-auto",children:[(0,o.jsx)("span",{className:"mr-2 text-green-400 whitespace-nowrap",children:"".concat(k(j.current),"$")})," ",(0,o.jsx)(x,{ref:b,value:m,onChange:e=>{let t=e.target.value;h(t),d(s,t)},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),S())},className:"flex-1 text-green-300 bg-black border-none focus:outline-none focus:ring-0 p-0 font-mono",placeholder:"",spellCheck:"false",autoComplete:"off",onFocus:e=>{let t=e.target.value.length;e.target.setSelectionRange(t,t)}})]})]})},initialWidth:600,initialHeight:400}],em=(e,t,n)=>{var o,r;let a=e["windowSize_".concat(t)];if(a&&"object"==typeof a&&a.width&&a.height)return{width:a.width,height:a.height};let i=null!==(o=null==n?void 0:n.initialWidth)&&void 0!==o?o:400,l=null!==(r=null==n?void 0:n.initialHeight)&&void 0!==r?r:300;return{width:i>0?i:400,height:l>0?l:300}},eh=(e,t,n)=>{var o,r;let a=e["windowPosition_".concat(t)];return a&&"object"==typeof a&&"number"==typeof a.x&&"number"==typeof a.y?{x:a.x,y:a.y}:n||{x:50+parseInt(null!==(o=t.split("-")[1])&&void 0!==o?o:"0",10)%5*20,y:50+parseInt(null!==(r=t.split("-")[1])&&void 0!==r?r:"0",10)%5*20}};function eg(){var e;let[t,n,d]=(0,l.A)(),{toast:f}=(0,c.dj)(),[p,m]=(0,r.useState)(null),[h,g]=(0,r.useState)(null),[x,v]=(0,r.useState)(!1),[b,y]=(0,r.useState)(!1),[w,j]=(0,r.useState)(null),[N,k]=(0,r.useState)(!1),[S,C]=(0,r.useState)(null),[I,A]=(0,r.useState)([]),[z,E]=(0,r.useState)(null),M=(0,r.useRef)(!1),R=(0,r.useRef)(null),P=(0,r.useRef)(!1),[L,O]=(0,r.useState)([]),[F,D]=(0,r.useState)(1),[_,T]=(0,r.useState)(null),[W,U]=(0,r.useState)(["root"]),[V,Y]=(0,r.useState)({}),[B,$]=(0,r.useState)(null),[q,ee]=(0,r.useState)({}),et=(0,r.useRef)({}),en=(0,r.useRef)(null),eo=(0,r.useCallback)((e,t)=>{et.current[e]=t},[]),er=(0,r.useCallback)((e,t)=>{if(!e||0===t.length||"root"!==t[0])return null;let n=e;for(let e=1;e<t.length;e++){let o=t[e];if(!(n&&"folder"===n.type&&Array.isArray(n.children))||!(n=n.children.find(e=>e.name===o)))return null}return n},[]),ea=(0,r.useCallback)(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:["root"];if(!n)return[];let r=(n,o)=>{if(!n||!n.name)return[];if(n.name===e&&(!t||n.type===t)){if(n.path&&n.path.startsWith("root")){let t=n.path.split("/");if(t[t.length-1]===e)return t;console.warn("Stored path for ".concat(e," (").concat(n.path,") seems inconsistent with name. Falling back to built path."))}return o}if("folder"===n.type&&Array.isArray(n.children))for(let e of n.children){let t=[...o,e.name],n=r(e,t);if(n.length>0)return n}return[]};return r(n,o)},[_]),ei=(0,r.useCallback)(()=>er(_,W),[_,W,er]);(0,r.useCallback)(()=>{let e=ei();return(null==e?void 0:e.children)||[]},[ei]);let el=(0,r.useCallback)(e=>{N&&z!==w||T(e)},[N,z,w]),es=(0,r.useCallback)(e=>{N&&z!==w||U(e)},[N,z,w]),eu=(0,r.useCallback)((e,t)=>{N&&z!==w||ee(n=>{let o=n[e]||{inputValue:"",output:""};return o.inputValue===t?n:{...n,[e]:{...o,inputValue:t}}})},[N,z,w]),eg=(0,r.useCallback)((e,t)=>{N&&z!==w||ee(n=>{let o=n[e]||{inputValue:"",output:""};return o.output===t?n:{...n,[e]:{...o,output:t}}})},[N,z,w]),ex=(0,r.useCallback)(e=>{var t;(!N||z===w)&&(B!==e||(null===(t=L.find(t=>t.instanceId===e))||void 0===t?void 0:t.isMinimized))&&O(t=>(D(e=>e+1),$(e),t.map(t=>t.instanceId===e?{...t,zIndex:F,isMinimized:!1}:t)))},[B,L,N,z,w,F]),ev=(0,r.useCallback)((e,t,n)=>{if(N&&z!==w){console.warn("Teacher view is read-only. Cannot save file."),f({title:"Read-only",description:"Cannot save changes while viewing another user.",variant:"destructive"});return}console.log("Attempting to save:",t,"at path segments:",n),T(o=>{if(!o)return console.error("Filesystem not available for saving."),null;let r=JSON.parse(JSON.stringify(o)),a=r,i=Array.isArray(n)?n:[];console.log("Navigating to save folder:",i.join("/"));for(let e=0;e<i.length;e++){let t=i[e];if(0===e&&"root"===t){a=r;continue}if(!(a&&"folder"===a.type&&Array.isArray(a.children)))return console.error('Invalid node or missing children at segment "'.concat(t,'" in path: ').concat(i.join("/"))),f({title:"Save Error",description:"Invalid save path: ".concat(i.join("/")),variant:"destructive"}),o;{let e=a.children.find(e=>e.name===t&&"folder"===e.type);if(!e||"folder"!==e.type)return console.error('Path segment "'.concat(t,'" not found or not a folder in path: ').concat(i.join("/"))),f({title:"Save Error",description:"Could not find directory path: ".concat(i.join("/")),variant:"destructive"}),o;a=e}}if(!(a&&"folder"===a.type&&Array.isArray(a.children)))return console.error('Final save path folder "'.concat(i.join("/"),'" not found or is not a folder.')),f({title:"Save Error",description:"Invalid save path: ".concat(i.join("/")),variant:"destructive"}),o;{console.log("Found target folder for saving:",a.name);let n=a.children.findIndex(e=>e.name===t&&"file"===e.type),o=["root",...i.slice(1),t].join("/");return n>-1?(a.children[n].content=e,a.children[n].path=o,console.log("File updated at path: ".concat(o))):(a.children.push({type:"file",name:t,content:e,path:o}),console.log("File created at path: ".concat(o))),O(t=>t.map(t=>{var n;return(null===(n=t.file)||void 0===n?void 0:n.path)===o?(console.log("Updating open app instance ".concat(t.instanceId," with new content for file ").concat(o)),{...t,file:{...t.file,content:e,path:o}}):t})),r}})},[N,z,w,f]),eb=(0,r.useCallback)(u()(async(e,t)=>{if(!t||N&&z!==t||M.current){console.log("Save skipped. currentUserId:",t,"isTeacher:",N,"viewingUserId:",z,"isApplyingRemote:",M.current);return}try{let n=ed({openApps:e.openApps,nextZIndex:e.nextZIndex,fileSystem:e.fileSystem,currentPath:e.currentPath,iconPositions:e.iconPositions,focusedWindowInstanceId:e.focusedWindowInstanceId,commandLineStates:e.commandLineStates,...t===w&&h&&{schoolId:h.schoolId}});if("string"==typeof n.fileSystem){console.error("Attempting to save stringified fileSystem:",n.fileSystem),f({title:"Save Error",description:"Internal error: File system state is invalid.",variant:"destructive"});return}console.log("Debounced save triggered for user: ".concat(t),n);let o=(0,X.H9)(K,"userStates",t);await (0,X.BN)(o,n,{merge:!0}),console.log("State successfully saved for user: ".concat(t))}catch(e){console.error("Error saving state to Firestore:",e)}},1e3),[N,z,f,w,h]),ey=(0,r.useCallback)(e=>{en.current&&e&&(console.log("Initializing default icon positions..."),Y(t=>{var n,o;let r=er(e,["root","Desktop"]),a=r&&"folder"===r.type&&Array.isArray(r.children)?r.children:[],i={...t},l=!1,s=Math.max(1,Math.floor(((null!==(o=null===(n=en.current)||void 0===n?void 0:n.offsetWidth)&&void 0!==o?o:800)-32)/110)),c=new Set;return(Object.entries(i).forEach(e=>{let[t,n]=e;if(n&&"number"==typeof n.x&&"number"==typeof n.y){let e=Math.round((n.x-16)/110),t=Math.round((n.y-16)/110);c.add("".concat(t,"-").concat(e))}else console.warn("Invalid position for icon ".concat(t,":"),n),delete i[t]}),a.forEach(e=>{let t=e.path||"desktop-".concat(e.type,"-").concat(e.name);if(!(t in i)||!i[t]||"number"!=typeof i[t].x||"number"!=typeof i[t].y){let e=0,n=0;for(;c.has("".concat(e,"-").concat(n));)if(++n>=s&&(n=0,e++),e*s+n>2*a.length){console.warn("Could not find empty slot for icon, placing at default.");break}let o=16+110*n,r=16+110*e;i[t]={x:o,y:r},c.add("".concat(e,"-").concat(n)),l=!0,console.log("Assigning initial/new position to ".concat(t,": x=").concat(o,", y=").concat(r," (row ").concat(e,", col ").concat(n,")"))}}),l)?(console.log("Icon positions initialized/updated:",i),i):(console.log("No icon position changes needed."),t)}))},[er]),ew=(0,r.useCallback)(async e=>{if(!e){console.log("Load cancelled: No targetUserId provided.");return}console.log("Attempting to load state for user:",e);let t=(0,X.H9)(K,"userStates",e);M.current=!0;try{let o=await (0,X.x7)(t);if(o.exists()){console.log("Loading existing state for user:",e);let t=o.data(),n=t.fileSystem?ed(t.fileSystem):ec,r=Array.isArray(t.openApps)?ed(t.openApps):[],a="object"!=typeof t.iconPositions||null===t.iconPositions||Array.isArray(t.iconPositions)?{}:ed(t.iconPositions),i=Array.isArray(t.currentPath)?t.currentPath:["root"],l="number"==typeof t.nextZIndex?t.nextZIndex:1,s="string"==typeof t.focusedWindowInstanceId?t.focusedWindowInstanceId:null,c="object"==typeof t.commandLineStates&&null!==t.commandLineStates?ed(t.commandLineStates):{};O(r),D(l),T(n),U(i),Y(a),$(s),ee(c),n&&0===Object.keys(a).length?(console.log("No icon positions found in loaded state, initializing defaults."),ey(n)):a&&Object.keys(a).length>0&&console.log("Loaded existing icon positions:",a)}else{console.log("No state found for user:",e,". Initializing default state locally.");let t=JSON.parse(JSON.stringify(ec));if(T(t),U(["root"]),O([]),D(1),Y({}),$(null),ee({}),ey(t),e===w&&!e.startsWith("guest_")){var n;let o={openApps:[],nextZIndex:1,fileSystem:t,currentPath:["root"],iconPositions:{},focusedWindowInstanceId:null,commandLineStates:{},schoolId:null!==(n=null==h?void 0:h.schoolId)&&void 0!==n?n:void 0};eb(o,e)}}}catch(t){console.error("Error loading state for user:",e,t),f({title:"Load Error",description:"Could not load state for user ".concat(e,"."),variant:"destructive"})}finally{setTimeout(()=>{M.current=!1,console.log("Reset remote state flag after load.")},150)}},[w,ey,eb,f,null==h?void 0:h.schoolId]);(0,r.useEffect)(()=>{let e=(0,Z.hg)(Q,async e=>{m(e);let o=null;if(e){console.log("User logged in:",e.uid),j(o=e.uid),v(!1);let t=(0,X.H9)(K,"users",e.uid),n=await (0,X.x7)(t);if(n.exists()){let e=n.data();g(e);let t="teacher"===e.role,r=e.schoolId;if(console.log("User role:",e.role,"School ID:",r),k(t),C(r),t&&r)try{(0,X.rJ)(K,"userStates");let e=(0,X.P)((0,X.rJ)(K,"userStates"),(0,X._M)("schoolId","==",r)),t=(await (0,X.GG)(e)).docs.map(e=>e.id).filter(e=>e!==o);A(t),console.log("Fetched available users for teacher in school",r,":",t)}catch(e){console.error("Error fetching users for teacher:",e),f({title:"Error",description:"Could not fetch student list.",variant:"destructive"}),A([])}else A([]),console.log("Not a teacher or missing schoolId, clearing available users.");(null===z||z.startsWith("guest_"))&&E(o)}else console.warn("User document not found in Firestore for UID:",e.uid),g(null),k(!1),C(null),A([]),(null===z||z.startsWith("guest_"))&&E(o)}else{console.log("User logged out or no user"),g(null),k(!1),C(null),A([]),E(null);let e=t.webosGuestUserId||"guest_".concat(Date.now(),"_").concat(Math.random().toString(16).substring(2,8));t.webosGuestUserId||n("webosGuestUserId",e,{path:"/",maxAge:31536e3}),j(o=e),E(o),v(!0)}o&&!P.current?(await ew(o),y(!0),P.current=!0):o||P.current||(y(!0),P.current=!0)});return()=>e()},[t.webosGuestUserId,n,ew,f]),(0,r.useEffect)(()=>{if(!P.current||!z){console.log("Listener setup skipped. Hydrated:",P.current,"Viewing:",z);return}console.log("Setting up Firestore listener for viewing user: ".concat(z)),R.current&&(console.log("Cleaning up previous Firestore listener."),R.current(),R.current=null);let e=(0,X.H9)(K,"userStates",z);return R.current=(0,X.aQ)(e,e=>{let t=w===z&&!N;if(console.log("Snapshot received for ".concat(z,". Applying remote state flag: ").concat(M.current,". Is own state update (non-teacher): ").concat(t)),M.current||t){console.log("Snapshot received for ".concat(z,", but skipping application (applyingRemoteState: ").concat(M.current,", isOwnStateUpdate: ").concat(t,")")),M.current&&setTimeout(()=>{M.current=!1,console.log("Reset remote state flag after snapshot processing was skipped.")},50);return}if(e.exists()){console.log("Applying remote state update from Firestore for: ".concat(z)),M.current=!0;let t=e.data(),n=t.fileSystem?ed(t.fileSystem):ec,o=Array.isArray(t.openApps)?ed(t.openApps):[],r="object"!=typeof t.iconPositions||null===t.iconPositions||Array.isArray(t.iconPositions)?{}:ed(t.iconPositions),a=Array.isArray(t.currentPath)?t.currentPath:["root"],i="number"==typeof t.nextZIndex?t.nextZIndex:1,l="string"==typeof t.focusedWindowInstanceId?t.focusedWindowInstanceId:null,s="object"==typeof t.commandLineStates&&null!==t.commandLineStates?ed(t.commandLineStates):{};O(o),D(i),T(n),U(a),Y(r),$(l),ee(s),n&&0===Object.keys(r).length?(console.log("No icon positions found in remote state, initializing defaults."),ey(n)):r&&Object.keys(r).length>0&&console.log("Applied existing icon positions from remote:",r),setTimeout(()=>{M.current=!1,console.log("Reset remote state flag after applying snapshot.")},50)}else console.log("No state found for user: ".concat(z," in Firestore.")),N&&w!==z?(M.current=!0,O([]),D(1),T(ec),U(["root"]),Y({}),$(null),ee({}),ey(ec),f({title:"User State Not Found",description:"State for ".concat(z," not found. Displaying defaults."),variant:"destructive"}),setTimeout(()=>{M.current=!1},50)):(console.warn("State for current user ".concat(w," not found in Firestore.")),setTimeout(()=>{M.current=!1},50))},e=>{console.error("Firestore snapshot error for ".concat(z,":"),e),M.current=!1,f({title:"Sync Error",description:"Could not sync state for ".concat(z,"."),variant:"destructive"})}),()=>{R.current&&(console.log("Unsubscribing Firestore listener for: ".concat(z)),R.current(),R.current=null)}},[z,b,N,w,f,ey]),(0,r.useEffect)(()=>{P.current&&w&&(!N||z===w)&&!M.current&&eb({openApps:L,nextZIndex:F,fileSystem:_,currentPath:W,iconPositions:V,focusedWindowInstanceId:B,commandLineStates:q,schoolId:w&&!w.startsWith("guest_")&&h?h.schoolId:void 0},w)},[L,F,_,W,V,B,q,w,N,z,eb,h]);let ej=(0,r.useCallback)((e,t,n)=>{let o=Math.round((e.x-16)/110);return{x:Math.max(16,Math.min(16+110*o,t-100-16)),y:Math.max(16,Math.min(16+110*Math.round((e.y-16)/110),n-100-16-48))}},[]),eN=(0,r.useCallback)((e,t)=>{if(N&&z!==w||!en.current)return;let n=en.current.getBoundingClientRect(),o=ej(t,n.width,n.height);Y(t=>{let r={...t},a=!1,i=null,l=t[e];for(let[t,l]of Object.entries(r))if(t!==e){if(l&&"number"==typeof l.x&&"number"==typeof l.y){let e=ej(l,n.width,n.height);if(e.x===o.x&&e.y===o.y){a=!0,i=t;break}}else console.warn("Skipping collision check for ".concat(t," due to invalid position:"),l)}if(a&&i&&l){let t=ej(l,n.width,n.height),a=r[i];a&&"number"==typeof a.x&&"number"==typeof a.y?(r[e]=ej(a,n.width,n.height),r[i]=t,console.log("Collision detected: Swapping ".concat(e," and ").concat(i))):(console.warn("Could not swap ".concat(e," with ").concat(i," due to invalid position of ").concat(i,". Placing ").concat(e," at snapped position.")),r[e]=o)}else r[e]=o,console.log("Moved ".concat(e," to snapped position:"),o);let s=new Map,c={...r},d=!1,u=[];return Object.entries(c).forEach(e=>{let[t,n]=e;if(!n||"number"!=typeof n.x||"number"!=typeof n.y){console.warn("Skipping overlap check for ".concat(t," due to invalid position:"),n),u.push(t),d=!0;return}let o="".concat(n.x,"-").concat(n.y);s.has(o)&&s.get(o)!==t?(console.warn("Overlap detected for ".concat(t," at ").concat(o," (occupied by ").concat(s.get(o),"). Re-assigning.")),u.push(t),d=!0):s.set(o,t)}),d&&u.forEach(e=>{let t=0,o=0,r=Math.max(1,Math.floor((n.width-32)/110));for(;s.has("".concat(16+110*o,"-").concat(16+110*t));)if(++o>=r&&(o=0,t++),t*r+o>2*Object.keys(c).length){console.warn("Could not find empty slot for icon during overlap resolution, placing at default.");break}let a=16+110*o,i=16+110*t;c[e]={x:a,y:i},s.set("".concat(a,"-").concat(i),e),console.log("Reassigned ".concat(e," due to overlap/invalid position to x=").concat(a,", y=").concat(i))}),c})},[ej,N,z,w]),ek=(0,r.useCallback)((e,t)=>V[e]||{x:16+t%10*110,y:16+110*Math.floor(t/10)},[V]),eS=(0,r.useCallback)(e=>{N&&z!==w||(O(t=>{let n=t.find(t=>t.instanceId===e),o=t.filter(t=>t.instanceId!==e);(null==n?void 0:n.id)==="commandline"&&(ee(t=>{let n={...t};return delete n[e],n}),d("commandLineInput_".concat(e),{path:"/"}),d("commandLineOutput_".concat(e),{path:"/"}));let r=null,a=o.filter(e=>!e.isMinimized);return a.length>0&&(r=a.reduce((e,t)=>e.zIndex>t.zIndex?e:t).instanceId),$(r),o}),d("windowPosition_".concat(e),{path:"/"}),d("windowSize_".concat(e),{path:"/"}))},[d,N,z,w]),eC=(0,r.useCallback)(e=>{N&&z!==w||O(t=>{let n=t.map(t=>t.instanceId===e?{...t,isMinimized:!0}:t);if(B===e){let e=null,t=n.filter(e=>!e.isMinimized);t.length>0&&(e=t.reduce((e,t)=>e.zIndex>t.zIndex?e:t).instanceId),$(e)}return n})},[B,N,z,w]),eI=(0,r.useCallback)(e=>{if(N&&z!==w)return;let n=0;O(o=>{let r=Math.max(0,...o.map(e=>e.zIndex))+1;return n=r,o.map(n=>{if(n.instanceId===e){let o=!n.isMaximized,a=n.position||eh(t,e),i=n.size||em(t,e,ep.find(e=>e.id===n.id));return{...n,isMaximized:o,zIndex:r,isMinimized:!1,originalPosition:n.isMaximized?n.originalPosition:a,originalSize:n.isMaximized?n.originalSize:i,position:o?{x:0,y:0}:n.originalPosition||a,size:o?{width:window.innerWidth,height:window.innerHeight-48}:n.originalSize||i}}return n})}),D(n+1),$(e)},[t,N,z,w]),eA=(0,r.useCallback)(e=>{N&&z!==w||ex(e)},[ex,N,z,w]),ez=(0,r.useCallback)((e,t,o)=>{N&&z!==w||O(r=>r.map(r=>{if(r.instanceId===e&&!r.isMaximized){let a={...r};return t&&(a.position=t),o&&(a.size=o),t&&n("windowPosition_".concat(e),t,{path:"/",maxAge:2592e3}),o&&n("windowSize_".concat(e),o,{path:"/",maxAge:2592e3}),a}return r}))},[N,z,w,n]),eE=(0,r.useCallback)((e,n)=>{if(N&&z!==w)return;let o=ep.find(t=>t.id===e);if(!o){console.warn("App definition not found for ID: ".concat(e));return}let r="".concat(e,"-").concat(Date.now(),"-").concat(Math.random().toString(16).substring(2,8)),a=em(t,r,o),i=eh(t,r);O(o=>{let l=Math.max(0,...o.map(e=>e.zIndex))+1;return D(l+1),$(r),[...o,{id:e,instanceId:r,zIndex:l,isMinimized:!1,isMaximized:!1,position:i,size:a,originalPosition:i,originalSize:a,file:n,commandLineState:"commandline"===e?{inputValue:t["commandLineInput_".concat(r)]||"",output:t["commandLineOutput_".concat(r)]||""}:void 0}]})},[t,N,z,w]),eM=(0,r.useCallback)(function(e){let t,n,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(N&&z!==w)return;let a=!1;if("string"==typeof e)t=e,a=!0;else if("app-shortcut"===e.type)t=e.appId,a=r||o;else if("file"===e.type){if(n=e,e.name.endsWith(".txt")?t="texteditor":e.name.endsWith(".py")?t="scripteditor":/\.(jpg|jpeg|png|gif)$/i.test(e.name)&&e.url&&(t="imageviewer"),a=o,!t&&o){alert('No application configured to open "'.concat(e.name,'".'));return}}else if("folder"===e.type&&o){let n=ea(e.name,"folder",_);if(n.length>0)es(n),t="filebrowser",a=!0;else{console.warn("Could not find path for folder:",e.name),f({title:"Error",description:"Could not navigate to folder ".concat(e.name,"."),variant:"destructive"});return}}if(a&&t){if(!ep.find(e=>e.id===t)){console.warn("App definition not found for ID: ".concat(t));return}let e=L.find(e=>{var o;return e.id===t&&(!n||(null===(o=e.file)||void 0===o?void 0:o.path)===n.path)});e?ex(e.instanceId):eE(t,n)}},[L,_,ea,es,ex,eE,N,z,w,f]),eR=(0,r.useMemo)(()=>{let e=er(_,["root","Desktop"]);return(null==e?void 0:e.type)==="folder"&&Array.isArray(e.children)?e.children:[]},[_,er]);return b&&_?(0,o.jsx)(a.Q,{backend:i.t2,children:(0,o.jsxs)("div",{ref:en,className:"relative inset-0 flex flex-col items-start justify-start overflow-hidden bg-desktop-background h-screen w-screen",children:[(0,o.jsx)(ef,{isOpen:x}),N&&(0,o.jsxs)("div",{className:"absolute top-2 left-2 z-[60] bg-background border p-2 rounded shadow",children:[(0,o.jsx)("label",{htmlFor:"user-select",className:"block text-sm font-medium text-foreground mb-1",children:"View Screen:"}),(0,o.jsxs)("select",{id:"user-select",value:z||"",onChange:e=>{let t=e.target.value;console.log("Teacher selected view:",t),E(t||null),ew(t||null)},className:"block w-full p-1 border border-input rounded bg-background text-foreground",children:[(0,o.jsxs)("option",{value:w||"",children:["Your Screen (",(null==h?void 0:null===(e=h.email)||void 0===e?void 0:e.split("@")[0])||"Me",")"]}),I.map(e=>(0,o.jsxs)("option",{value:e,children:["Student ",e.substring(0,6),"..."]},e))]}),z!==w&&(0,o.jsxs)("p",{className:"text-xs text-yellow-500 mt-1",children:["Viewing ",null==z?void 0:z.substring(0,6),"... (Read-only)"]})]}),(0,o.jsx)("div",{className:"relative flex-grow w-full overflow-hidden p-4",children:eR.map((e,t)=>{let n=e.path||"desktop-".concat(e.type,"-").concat(e.name,"-").concat(t),r=ek(n,t);return(0,o.jsx)(G,{id:n,icon:e.icon||("folder"===e.type?"\uD83D\uDCC1":"app-shortcut"===e.type?"\uD83D\uDE80":"\uD83D\uDCC4"),name:e.name,initialPosition:r,onClick:()=>eM(e,!1,!0),onMoveEnd:eN,containerRef:en,gridSize:110,padding:16},n)})}),L.map(e=>{var n,r,a,i,l,s,c,d;let u=ep.find(t=>t.id===e.id);if(!u)return console.warn("App definition not found for ID: ".concat(e.id)),null;let f={...e.file&&{initialText:e.file.content,fileName:e.file.name,imageUrl:e.file.url,initialScript:e.file.content},openAppOrFile:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return eM(e,t,!1)},fileSystem:_,currentPath:W,onFileSystemChange:el,onCurrentPathChange:es,onFileSave:(t,n)=>{var o;ev(t,n,(null===(o=e.file)||void 0===o?void 0:o.path)?e.file.path.split("/").slice(0,-1):W)},instanceId:e.instanceId,..."commandline"===u.id&&{initialInputValue:null!==(l=null===(n=q[e.instanceId])||void 0===n?void 0:n.inputValue)&&void 0!==l?l:"",initialOutput:null!==(s=null===(r=q[e.instanceId])||void 0===r?void 0:r.output)&&void 0!==s?s:"",onInputChange:eu,onOutputChange:eg,isFocused:B===e.instanceId}};return(0,o.jsx)(H,{id:e.id,instanceId:e.instanceId,name:e.file?"".concat(u.name," - ").concat(e.file.name):u.name,icon:u.icon,component:u.component,componentProps:f,initialWidth:null!==(c=null===(a=e.originalSize)||void 0===a?void 0:a.width)&&void 0!==c?c:em(t,e.instanceId,u).width,initialHeight:null!==(d=null===(i=e.originalSize)||void 0===i?void 0:i.height)&&void 0!==d?d:em(t,e.instanceId,u).height,initialPosition:e.position||eh(t,e.instanceId),zIndex:e.zIndex,onClose:()=>eS(e.instanceId),bringToFront:ex,minimizeApp:eC,isMinimized:e.isMinimized,isMaximized:e.isMaximized,toggleMaximize:eI,windowRefSetter:eo,onWindowMoveOrResize:ez,isFocused:B===e.instanceId,openAppOrFile:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return eM(e,t,!1)},fileSystem:_,currentPath:W,onFileSystemChange:el,onCurrentPathChange:es,onFileSave:ev,onCommandLineInputChange:eu,onCommandLineOutputChange:eg},e.instanceId)}),(0,o.jsx)(J,{openApps:L,applications:ep,onAppClick:ex,onRestore:eA,onMinimize:eC}),(0,o.jsx)(s.Toaster,{})]})}):(0,o.jsx)("div",{className:"flex items-center justify-center h-screen w-screen bg-desktop-background text-white",children:"Loading OS..."})}},2558:(e,t,n)=>{"use strict";n.d(t,{Toaster:()=>x});var o=n(5155),r=n(7481),a=n(2115),i=n(3057),l=n(2085),s=n(5318),c=n(9434);let d=i.Kq,u=a.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(i.LM,{ref:t,className:(0,c.cn)("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",n),...r})});u.displayName=i.LM.displayName;let f=(0,l.F)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),p=a.forwardRef((e,t)=>{let{className:n,variant:r,...a}=e;return(0,o.jsx)(i.bL,{ref:t,className:(0,c.cn)(f({variant:r}),n),...a})});p.displayName=i.bL.displayName,a.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(i.rc,{ref:t,className:(0,c.cn)("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",n),...r})}).displayName=i.rc.displayName;let m=a.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(i.bm,{ref:t,className:(0,c.cn)("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",n),"toast-close":"",...r,children:(0,o.jsx)(s.A,{className:"h-4 w-4"})})});m.displayName=i.bm.displayName;let h=a.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(i.hE,{ref:t,className:(0,c.cn)("text-sm font-semibold",n),...r})});h.displayName=i.hE.displayName;let g=a.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(i.VY,{ref:t,className:(0,c.cn)("text-sm opacity-90",n),...r})});function x(){let{toasts:e}=(0,r.dj)();return(0,o.jsxs)(d,{children:[e.map(function(e){let{id:t,title:n,description:r,action:a,...i}=e;return(0,o.jsxs)(p,{...i,children:[(0,o.jsxs)("div",{className:"grid gap-1",children:[n&&(0,o.jsx)(h,{children:n}),r&&(0,o.jsx)(g,{children:r})]}),a,(0,o.jsx)(m,{})]},t)}),(0,o.jsx)(u,{})]})}g.displayName=i.VY.displayName},2751:(e,t,n)=>{Promise.resolve().then(n.bind(n,2048))},7481:(e,t,n)=>{"use strict";n.d(t,{dj:()=>f});var o=n(2115);let r=0,a=new Map,i=e=>{if(a.has(e))return;let t=setTimeout(()=>{a.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);a.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:n}=t;return n?i(n):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===n||void 0===n?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},s=[],c={toasts:[]};function d(e){c=l(c,e),s.forEach(e=>{e(c)})}function u(e){let{...t}=e,n=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),o=()=>d({type:"DISMISS_TOAST",toastId:n});return d({type:"ADD_TOAST",toast:{...t,id:n,open:!0,onOpenChange:e=>{e||o()}}}),{id:n,dismiss:o,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:n}})}}function f(){let[e,t]=o.useState(c);return o.useEffect(()=>(s.push(t),()=>{let e=s.indexOf(t);e>-1&&s.splice(e,1)}),[]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},9434:(e,t,n)=>{"use strict";n.d(t,{cn:()=>a});var o=n(2596),r=n(9688);function a(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,r.QP)((0,o.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[156,992,752,832,441,684,358],()=>t(2751)),_N_E=e.O()}]);